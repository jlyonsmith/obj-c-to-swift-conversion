<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Conversion of `@implementation` | The Guide to Objective-C to Swift Conversion</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.4">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    
    <link rel="prev" href="./Interface-Props.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="11"
        data-chapter-title="Conversion of `@implementation`"
        data-filepath="Implementation.md"
        data-basepath="."
        data-revision="Thu Dec 03 2015 15:20:59 GMT-0800 (PST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="One-File.html">
            
                
                    <a href="./One-File.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        One File at a Time
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Search-Replace.html">
            
                
                    <a href="./Search-Replace.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Search/Replace
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Type-Conversions.html">
            
                
                    <a href="./Type-Conversions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Type Conversions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Bridging.html">
            
                
                    <a href="./Bridging.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Bridging Headers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Headers.html">
            
                
                    <a href="./Headers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        `#include` vs. Import
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Methods.html">
            
                
                    <a href="./Methods.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Method Signatures
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Typedef.html">
            
                
                    <a href="./Typedef.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Conversion of `typedef`
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Protocol.html">
            
                
                    <a href="./Protocol.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Conversion of `@protocol`
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Interface-Methods.html">
            
                
                    <a href="./Interface-Methods.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Conversion of `@interface` Methods
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Interface-Props.html">
            
                
                    <a href="./Interface-Props.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Conversion of `@interface` Properties
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="11" data-path="Implementation.html">
            
                
                    <a href="./Implementation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Conversion of `@implementation`
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >The Guide to Objective-C to Swift Conversion</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <p>This is where the majority of the conversion work takes place.  As an example, take the following:</p>
<pre><code class="lang-obj-c"><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">RSImagePathHelper</span></span>

<span class="hljs-comment">// Preferred constructor:</span>
- (instancetype)initWithUserDefaults:(<span class="hljs-built_in">NSUserDefaults</span>*)userDefaults
{
    <span class="hljs-built_in">NSString</span> *domain = [RSBackendApi urls]<span class="hljs-variable">.assetsUrl</span>;

    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> initWithDomain:domain];
}

- (instancetype)initWithDomain:(<span class="hljs-built_in">NSString</span>*)domain
{
    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span><span class="hljs-variable">.domain</span> = domain;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}

- (<span class="hljs-built_in">NSURL</span>*)buildUrlForImage:(<span class="hljs-keyword">id</span>&lt;ImageProtocol&gt;)image sizeType:(RSImageSize)sizeType
{
    <span class="hljs-keyword">if</span> (image) {
        <span class="hljs-keyword">@try</span> {
            <span class="hljs-built_in">NSString</span>* sizeString = [<span class="hljs-keyword">self</span> getSizeString:sizeType];
            <span class="hljs-built_in">NSString</span>* imagePath = [image<span class="hljs-variable">.path</span> stringByReplacingOccurrencesOfString:<span class="hljs-string">@&quot;files&quot;</span> withString:image<span class="hljs-variable">.hashName</span>];
            <span class="hljs-built_in">NSURL</span>* url = [<span class="hljs-built_in">NSURL</span> URLWithString:[[<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%@/%@/%@&quot;</span>, <span class="hljs-keyword">self</span><span class="hljs-variable">.domain</span>, sizeString, imagePath] stringByAddingPercentEscapesUsingEncoding:<span class="hljs-built_in">NSUTF8StringEncoding</span>]];
            <span class="hljs-keyword">return</span> url;
        }
        <span class="hljs-keyword">@catch</span> (<span class="hljs-built_in">NSException</span>* exception) {
            RSLOG(<span class="hljs-string">@&quot;%@&quot;</span>, exception);
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
}

- (<span class="hljs-built_in">NSURL</span>*)buildUrlForImagePath:(<span class="hljs-built_in">NSString</span>*)path withHash:(<span class="hljs-built_in">NSString</span>*)hash sizeType:(RSImageSize)sizeType
{
    <span class="hljs-keyword">if</span> (path) {
        <span class="hljs-keyword">@try</span> {
            <span class="hljs-built_in">NSString</span>* sizeString = [<span class="hljs-keyword">self</span> getSizeString:sizeType];
            <span class="hljs-built_in">NSString</span>* imagePath = [path stringByReplacingOccurrencesOfString:<span class="hljs-string">@&quot;files&quot;</span> withString:hash];
            <span class="hljs-built_in">NSURL</span>* url = [<span class="hljs-built_in">NSURL</span> URLWithString:[[<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%@/%@/%@&quot;</span>, <span class="hljs-keyword">self</span><span class="hljs-variable">.domain</span>, sizeString, imagePath] stringByAddingPercentEscapesUsingEncoding:<span class="hljs-built_in">NSUTF8StringEncoding</span>]];
            <span class="hljs-keyword">return</span> url;
        }
        <span class="hljs-keyword">@catch</span> (<span class="hljs-built_in">NSException</span>* exception) {
            RSLOG(<span class="hljs-string">@&quot;%@&quot;</span>, exception);
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;
}

- (<span class="hljs-built_in">NSString</span>*)getSizeString:(RSImageSize)sizeType
{
    <span class="hljs-keyword">switch</span> (sizeType) {
    <span class="hljs-keyword">case</span> RSImageSizeFull:
        <span class="hljs-keyword">return</span> <span class="hljs-string">@&quot;full&quot;</span>;
    <span class="hljs-keyword">case</span> RSImageSizeTiny:
        <span class="hljs-keyword">return</span> <span class="hljs-string">@&quot;tiny&quot;</span>;
    <span class="hljs-keyword">case</span> RSImageSizeMicro:
        <span class="hljs-keyword">return</span> <span class="hljs-string">@&quot;micro&quot;</span>;
    <span class="hljs-keyword">case</span> RSImageSizeSmall:
        <span class="hljs-keyword">return</span> <span class="hljs-string">@&quot;small&quot;</span>;
    <span class="hljs-keyword">case</span> RSImageSizeHuge:
        <span class="hljs-keyword">return</span> <span class="hljs-string">@&quot;1080&quot;</span>;
    }
}

<span class="hljs-keyword">@end</span>
</code></pre>
<p>One way to convert this is as follows:</p>
<pre><code class="lang-swift"><span class="hljs-keyword">import</span> Foundation <span class="hljs-comment">// 1</span>

<span class="hljs-preprocessor">@objc</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImagePathHelper</span> : <span class="hljs-title">NSObject</span>, <span class="hljs-title">ImagePathHelperProtocol</span> </span>{
    internal <span class="hljs-keyword">var</span> domain: <span class="hljs-type">String</span>!
    internal <span class="hljs-keyword">var</span> formCharacterSet: <span class="hljs-type">NSMutableCharacterSet</span>!

    private <span class="hljs-keyword">override</span> <span class="hljs-keyword">init</span>() { <span class="hljs-comment">// 2(a)</span>
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>()
    }

    <span class="hljs-keyword">init</span>(domain: <span class="hljs-type">String</span>) { <span class="hljs-comment">// 2(b)</span>
        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>()
        <span class="hljs-keyword">self</span>.domain = domain

        <span class="hljs-keyword">let</span> charSet = <span class="hljs-type">NSMutableCharacterSet</span>.alphanumericCharacterSet()

        charSet.addCharactersInString(<span class="hljs-string">&quot;-._* &quot;</span>)
        <span class="hljs-keyword">self</span>.formCharacterSet = charSet
    }

    <span class="hljs-comment">// 3</span>
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">stringByAddingPercentEncodingForFormData</span><span class="hljs-params">(fromString: String)</span></span> -&gt; <span class="hljs-type">String</span>? {
        <span class="hljs-keyword">return</span> fromString.stringByAddingPercentEncodingWithAllowedCharacters(<span class="hljs-keyword">self</span>.formCharacterSet)?.stringByReplacingOccurrencesOfString(<span class="hljs-string">&quot; &quot;</span>, withString: <span class="hljs-string">&quot;+&quot;</span>)
    }

    <span class="hljs-comment">// 4(a)</span>
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">buildUrlForImage</span><span class="hljs-params">(image: ImageProtocol?, sizeType: RSImageSize)</span></span> -&gt; <span class="hljs-type">NSURL</span>? {
        <span class="hljs-keyword">var</span> url: <span class="hljs-type">NSURL</span>?

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> safeImage = image {
            <span class="hljs-keyword">let</span> sizeString = <span class="hljs-keyword">self</span>.getSizeString(sizeType)
            <span class="hljs-keyword">let</span> imagePathWithFiles = safeImage.path.stringByReplacingOccurrencesOfString(<span class="hljs-string">&quot;files&quot;</span>, withString: safeImage.hashName)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> fullImagePath = stringByAddingPercentEncodingForFormData(<span class="hljs-string">&quot;<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.domain)</span>/<span class="hljs-subst">\(sizeString)</span>/<span class="hljs-subst">\(imagePathWithFiles)</span>&quot;</span>) {
                url = <span class="hljs-type">NSURL</span>(fileURLWithPath: fullImagePath)
            }
        }

        <span class="hljs-keyword">return</span> url
    }

    <span class="hljs-comment">// 4(b)</span>
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">buildUrlForImagePath</span><span class="hljs-params">(imagePath: String?, withHash hash: String, sizeType: RSImageSize)</span></span> -&gt; <span class="hljs-type">NSURL</span>? {
        <span class="hljs-keyword">var</span> url: <span class="hljs-type">NSURL</span>?

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> safeImagePath = imagePath {
            <span class="hljs-keyword">let</span> sizeString = <span class="hljs-keyword">self</span>.getSizeString(sizeType)
            <span class="hljs-keyword">let</span> imagePathWithFiles = safeImagePath.stringByReplacingOccurrencesOfString(<span class="hljs-string">&quot;files&quot;</span>, withString: hash)

            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> fullImagePath = stringByAddingPercentEncodingForFormData(<span class="hljs-string">&quot;<span class="hljs-subst">\(<span class="hljs-keyword">self</span>.domain)</span>/<span class="hljs-subst">\(sizeString)</span>/<span class="hljs-subst">\(imagePathWithFiles)</span>&quot;</span>) {
                url = <span class="hljs-type">NSURL</span>(fileURLWithPath: fullImagePath)
            }
        }

        <span class="hljs-keyword">return</span> url
    }

    <span class="hljs-comment">// 5</span>
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">getSizeString</span><span class="hljs-params">(sizeType: ImageSize)</span></span> -&gt; <span class="hljs-type">String</span> {
        <span class="hljs-keyword">switch</span> (sizeType) {
        <span class="hljs-keyword">case</span> .<span class="hljs-type">Full</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;full&quot;</span>
        <span class="hljs-keyword">case</span> .<span class="hljs-type">Tiny</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;tiny&quot;</span>
        <span class="hljs-keyword">case</span> .<span class="hljs-type">Micro</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;micro&quot;</span>
        <span class="hljs-keyword">case</span> .<span class="hljs-type">Small</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;small&quot;</span>
        <span class="hljs-keyword">case</span> .<span class="hljs-type">Huge</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1080&quot;</span>
        }
    }
}
</code></pre>
<p>Note that this includes both protocol, interface and property code from above.  There is quite a lot going on here so lets break it down.</p>
<ol>
<li>The <code>import</code> declaration replaces the pre-processor <code>#include</code> directives.  This brings symbols from the <code>Foundation</code>  library.  Symbols for the current project are automatically imported.</li>
<li>(a) Here we are hiding the <code>init</code> method from <code>NSObject</code> for classes that derived from this one with the <code>private</code> modifier.  Sometimes you want to do this for dependency injection frameworks, for example.  (b) Here we set the instance properties after calling the super class (remember, Swift objects force two phase initialization)</li>
<li>Refactoring.  Here we are doing some refactoring during the conversion.  <code>stringByAddingPercentEscapesUsingEncoding</code> is deprecated in favor of <code>stringByAddingPercentEncodingWithAllowedCharacters</code>, so we take the opportunity to change the implementation a bit.  You have tests to catch any problems, right?</li>
<li>These two methods were using <code>NSException</code> to catch errors from either null references or other conversion failurs.  In Swift the preference is to favor using optionals and <code>try/catch</code> (which is <code>NSError</code> based, <em>not</em> <code>NSException</code> based)  Note the use of optional return types too so that the method can continue to return <code>nil</code> if it cannot do what it is supposed to.  A <em>much</em> preferred solution here would be to change the method to <code>throws</code> and return errors that way, but that would require changing all the call sites.  The goal in the first phase of conversion is to get <em>working</em> Swift code, we can make it idiomatic later.</li>
<li>This method is the most straightforward.  No surprises here.</li>
</ol>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./Interface-Props.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Conversion of `@interface` Properties"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
